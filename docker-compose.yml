version: "3.7"

services:
  cave:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "4000:4000"
    networks:
      - cave-net
    depends_on:
      - mysql
  mysql:
    container_name: cave-db
    platform: linux/x86_64
    image: mysql:8
    env_file:
      - .env
    ports:
      - "3306:3306"
    networks:
      - cave-net
    volumes:
      - mysql:/var/lib/mysql
volumes:
  mysql:
networks:
  cave-net:


## https://meetup.toast.com/posts/277
#
#version: "3"
#
#services:
#  cave:
#    image: node:18-alpine
#    command: sh -c "npm install && npm run start"
#    platform: linux/amd64
#    env_file:
#      - .env
#    ports:
#      - "4000:4000"
#    working_dir: /usr/src/app
#    volumes:
#      - ./:/usr/src/app
#    links:
#      - mysql
##    environment:
##      MYSQL_HOST: mysql
##      MYSQL_USER: root
##      MYSQL_PASSWORD: root
##      MYSQL_DB: cavedb
#  mysql:
#    image: mysql:8
#    platform: linux/amd64
#    ports:
#      - "3306:3306"
#    volumes:
#      - mysql-data:/var/lib/mysql
#    environment:
#      MYSQL_ROOT_PASSWORD: root
#      MYSQL_DATABASE: cavedb
#      TZ: Asia/Seoul
#    restart: always
#volumes:
#  mysql-data:
